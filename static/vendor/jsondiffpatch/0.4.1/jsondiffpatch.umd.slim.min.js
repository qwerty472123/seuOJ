!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("./empty"),require("./empty")):"function"==typeof define&&define.amd?define(["exports","./empty","./empty"],e):e(t.jsondiffpatch={},t["diff-match-patch"],t.chalk)}(this,function(t,e,n){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},f=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},l=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,f=t[Symbol.iterator]();!(r=(a=f.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&f.return&&f.return()}finally{if(i)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},c=function(){function t(e){i(this,t),this.selfOptions=e||{},this.pipes={}}return o(t,[{key:"options",value:function(t){return t&&(this.selfOptions=t),this.selfOptions}},{key:"pipe",value:function(t,e){var n=e;if("string"==typeof t){if(void 0===n)return this.pipes[t];this.pipes[t]=n}if(t&&t.name){if(n=t,n.processor===this)return n;this.pipes[n.name]=n}return n.processor=this,n}},{key:"process",value:function(t,e){var n=t;n.options=this.options();for(var r=e||t.pipe||"default",i=void 0,o=void 0;r;)void 0!==n.nextAfterChildren&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),"string"==typeof r&&(r=this.pipe(r)),r.process(n),o=n,i=r,r=null,n&&n.next&&(n=n.next,r=o.nextPipe||n.pipe||i);return n.hasResult?n.result:void 0}}]),t}(),d=function(){function t(e){i(this,t),this.name=e,this.filters=[]}return o(t,[{key:"process",value:function(t){if(!this.processor)throw new Error("add this pipe to a processor before using it");for(var e=this.debug,n=this.filters.length,i=t,o=0;o<n;o++){var a=this.filters[o];if(e&&this.log("filter: "+a.filterName),a(i),"object"===(void 0===i?"undefined":r(i))&&i.exiting){i.exiting=!1;break}}!i.next&&this.resultCheck&&this.resultCheck(i)}},{key:"log",value:function(t){console.log("[jsondiffpatch] "+this.name+" pipe, "+t)}},{key:"append",value:function(){var t;return(t=this.filters).push.apply(t,arguments),this}},{key:"prepend",value:function(){var t;return(t=this.filters).unshift.apply(t,arguments),this}},{key:"indexOf",value:function(t){if(!t)throw new Error("a filter name is required");for(var e=0;e<this.filters.length;e++){if(this.filters[e].filterName===t)return e}throw new Error("filter not found: "+t)}},{key:"list",value:function(){return this.filters.map(function(t){return t.filterName})}},{key:"after",value:function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e+1,0),Array.prototype.splice.apply(this.filters,n),this}},{key:"before",value:function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e,0),Array.prototype.splice.apply(this.filters,n),this}},{key:"replace",value:function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e,1),Array.prototype.splice.apply(this.filters,n),this}},{key:"remove",value:function(t){var e=this.indexOf(t);return this.filters.splice(e,1),this}},{key:"clear",value:function(){return this.filters.length=0,this}},{key:"shouldHaveResult",value:function(t){if(!1!==t){if(!this.resultCheck){var e=this;return this.resultCheck=function(t){if(!t.hasResult){console.log(t);var n=new Error(e.name+" failed");throw n.noResult=!0,n}},this}}else this.resultCheck=null}}]),t}(),h=function(){function t(){i(this,t)}return o(t,[{key:"setResult",value:function(t){return this.result=t,this.hasResult=!0,this}},{key:"exit",value:function(){return this.exiting=!0,this}},{key:"switchTo",value:function(t,e){return"string"==typeof t||t instanceof d?this.nextPipe=t:(this.next=t,e&&(this.nextPipe=e)),this}},{key:"push",value:function(t,e){return t.parent=this,void 0!==e&&(t.childName=e),t.root=this.root||this,t.options=t.options||this.options,this.children?(this.children[this.children.length-1].next=t,this.children.push(t)):(this.children=[t],this.nextAfterChildren=this.next||null,this.next=t),t.next=this,this}}]),t}(),p="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array};function v(t){if("object"!==(void 0===t?"undefined":r(t)))return t;if(null===t)return null;if(p(t))return t.map(v);if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return e=/^\/(.*)\/([gimyu]*)$/.exec(t.toString()),new RegExp(e[1],e[2]);var e,n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=v(t[i]));return n}var y=function(){function t(e,n){i(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.left=e,r.right=n,r.pipe="diff",r}return f(t,h),o(t,[{key:"setResult",value:function(t){if(this.options.cloneDiffValues&&"object"===(void 0===t?"undefined":r(t))){var e="function"==typeof this.options.cloneDiffValues?this.options.cloneDiffValues:v;"object"===r(t[0])&&(t[0]=e(t[0])),"object"===r(t[1])&&(t[1]=e(t[1]))}return h.prototype.setResult.apply(this,arguments)}}]),t}(),m=function(){function t(e,n){i(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.left=e,r.delta=n,r.pipe="patch",r}return f(t,h),t}(),g=function(){function t(e){i(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.delta=e,n.pipe="reverse",n}return f(t,h),t}(),x="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},_=function(t){if(t.left!==t.right)if(void 0!==t.left)if(void 0!==t.right){if("function"==typeof t.left||"function"==typeof t.right)throw new Error("functions are not supported");t.leftType=null===t.left?"null":r(t.left),t.rightType=null===t.right?"null":r(t.right),t.leftType===t.rightType&&"boolean"!==t.leftType&&"number"!==t.leftType?("object"===t.leftType&&(t.leftIsArray=x(t.left)),"object"===t.rightType&&(t.rightIsArray=x(t.right)),t.leftIsArray===t.rightIsArray?t.left instanceof RegExp&&(t.right instanceof RegExp?t.setResult([t.left.toString(),t.right.toString()]).exit():t.setResult([t.left,t.right]).exit()):t.setResult([t.left,t.right]).exit()):t.setResult([t.left,t.right]).exit()}else t.setResult([t.left,0,0]).exit();else{if("function"==typeof t.right)throw new Error("functions are not supported");t.setResult([t.right]).exit()}else t.setResult(void 0).exit()};_.filterName="trivial";var b=function(t){if(void 0!==t.delta){if(t.nested=!x(t.delta),!t.nested)if(1!==t.delta.length)if(2!==t.delta.length)3===t.delta.length&&0===t.delta[2]&&t.setResult(void 0).exit();else{if(t.left instanceof RegExp){var e=/^\/(.*)\/([gimyu]+)$/.exec(t.delta[1]);if(e)return void t.setResult(new RegExp(e[1],e[2])).exit()}t.setResult(t.delta[1]).exit()}else t.setResult(t.delta[0]).exit()}else t.setResult(t.left).exit()};b.filterName="trivial";var k=function(t){void 0!==t.delta?(t.nested=!x(t.delta),t.nested||(1!==t.delta.length?2!==t.delta.length?3===t.delta.length&&0===t.delta[2]&&t.setResult([t.delta[0]]).exit():t.setResult([t.delta[1],t.delta[0]]).exit():t.setResult([t.delta[0],0,0]).exit())):t.setResult(t.delta).exit()};function w(t){if(t&&t.children){for(var e=t.children.length,n=void 0,r=t.result,i=0;i<e;i++)void 0!==(n=t.children[i]).result&&((r=r||{})[n.childName]=n.result);r&&t.leftIsArray&&(r._t="a"),t.setResult(r).exit()}}function j(t){if(!t.leftIsArray&&"object"===t.leftType){var e=void 0,n=void 0,r=t.options.propertyFilter;for(e in t.left)Object.prototype.hasOwnProperty.call(t.left,e)&&(r&&!r(e,t)||(n=new y(t.left[e],t.right[e]),t.push(n,e)));for(e in t.right)Object.prototype.hasOwnProperty.call(t.right,e)&&(r&&!r(e,t)||void 0===t.left[e]&&(n=new y(void 0,t.right[e]),t.push(n,e)));t.children&&0!==t.children.length?t.exit():t.setResult(void 0).exit()}}k.filterName="trivial",w.filterName="collectChildren",j.filterName="objects";var O=function(t){if(t.nested&&!t.delta._t){var e=void 0,n=void 0;for(e in t.delta)n=new m(t.left[e],t.delta[e]),t.push(n,e);t.exit()}};O.filterName="objects";var R=function(t){if(t&&t.children&&!t.delta._t){for(var e=t.children.length,n=void 0,r=0;r<e;r++)n=t.children[r],Object.prototype.hasOwnProperty.call(t.left,n.childName)&&void 0===n.result?delete t.left[n.childName]:t.left[n.childName]!==n.result&&(t.left[n.childName]=n.result);t.setResult(t.left).exit()}};R.filterName="collectChildren";var C=function(t){if(t.nested&&!t.delta._t){var e=void 0,n=void 0;for(e in t.delta)n=new g(t.delta[e]),t.push(n,e);t.exit()}};function A(t){if(t&&t.children&&!t.delta._t){for(var e=t.children.length,n=void 0,r={},i=0;i<e;i++)r[(n=t.children[i]).childName]!==n.result&&(r[n.childName]=n.result);t.setResult(r).exit()}}C.filterName="objects",A.filterName="collectChildren";var N=function(t,e,n,r){return t[n]===e[r]},P=function(t,e,n,r){var i=r||{},o=function(t,e,n,r){for(var i=e.length,o=n.length,a={sequence:[],indices1:[],indices2:[]};0!==i&&0!==o;)t.match(e,n,i-1,o-1,r)?(a.sequence.unshift(e[i-1]),a.indices1.unshift(i-1),a.indices2.unshift(o-1),--i,--o):t[i][o-1]>t[i-1][o]?--o:--i;return a}(function(t,e,n,r){var i=t.length,o=e.length,a=void 0,f=void 0,s=[i+1];for(a=0;a<i+1;a++)for(s[a]=[o+1],f=0;f<o+1;f++)s[a][f]=0;for(s.match=n,a=1;a<i+1;a++)for(f=1;f<o+1;f++)s[a][f]=n(t,e,a-1,f-1,r)?s[a-1][f-1]+1:Math.max(s[a-1][f],s[a][f-1]);return s}(t,e,n||N,i),t,e,i);return"string"==typeof t&&"string"==typeof e&&(o.sequence=o.sequence.join("")),o},E="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},T="function"==typeof Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=t.length,r=0;r<n;r++)if(t[r]===e)return r;return-1};function D(t,e,n,i,o){var a=t[n],f=e[i];if(a===f)return!0;if("object"!==(void 0===a?"undefined":r(a))||"object"!==(void 0===f?"undefined":r(f)))return!1;var s=o.objectHash;if(!s)return o.matchByPosition&&n===i;var l=void 0,u=void 0;return"number"==typeof n?(o.hashCache1=o.hashCache1||[],void 0===(l=o.hashCache1[n])&&(o.hashCache1[n]=l=s(a,n))):l=s(a),void 0!==l&&("number"==typeof i?(o.hashCache2=o.hashCache2||[],void 0===(u=o.hashCache2[i])&&(o.hashCache2[i]=u=s(f,i))):u=s(f),void 0!==u&&l===u)}var S=function(t){if(t.leftIsArray){var e={objectHash:t.options&&t.options.objectHash,matchByPosition:t.options&&t.options.matchByPosition},n=0,r=0,i=void 0,o=void 0,a=void 0,f=t.left,s=t.right,l=f.length,u=s.length,c=void 0;for(l>0&&u>0&&!e.objectHash&&"boolean"!=typeof e.matchByPosition&&(e.matchByPosition=!function(t,e,n,r){for(var i=0;i<n;i++)for(var o=t[i],a=0;a<r;a++)if(i!==a&&o===e[a])return!0}(f,s,l,u));n<l&&n<u&&D(f,s,n,n,e);)c=new y(t.left[i=n],t.right[i]),t.push(c,i),n++;for(;r+n<l&&r+n<u&&D(f,s,l-1-r,u-1-r,e);)c=new y(t.left[o=l-1-r],t.right[a=u-1-r]),t.push(c,a),r++;var d=void 0;if(n+r!==l)if(n+r!==u){delete e.hashCache1,delete e.hashCache2;var h=f.slice(n,l-r),p=s.slice(n,u-r),v=P(h,p,D,e),m=[];for(d=d||{_t:"a"},i=n;i<l-r;i++)T(v.indices1,i-n)<0&&(d["_"+i]=[f[i],0,0],m.push(i));var g=!0;t.options&&t.options.arrays&&!1===t.options.arrays.detectMove&&(g=!1);var x=!1;t.options&&t.options.arrays&&t.options.arrays.includeValueOnMove&&(x=!0);var _=m.length;for(i=n;i<u-r;i++){var b=T(v.indices2,i-n);if(b<0){var k=!1;if(g&&_>0)for(var w=0;w<_;w++)if(D(h,p,(o=m[w])-n,i-n,e)){d["_"+o].splice(1,2,i,3),x||(d["_"+o][0]=""),c=new y(t.left[o],t.right[a=i]),t.push(c,a),m.splice(w,1),k=!0;break}k||(d[i]=[s[i]])}else c=new y(t.left[o=v.indices1[b]+n],t.right[a=v.indices2[b]+n]),t.push(c,a)}t.setResult(d).exit()}else{for(d=d||{_t:"a"},i=n;i<l-r;i++)d["_"+i]=[f[i],0,0];t.setResult(d).exit()}else{if(l===u)return void t.setResult(void 0).exit();for(d=d||{_t:"a"},i=n;i<u-r;i++)d[i]=[s[i]];t.setResult(d).exit()}}};S.filterName="arrays";var I=function(t,e){return t-e},V=function(t){return function(e,n){return e[t]-n[t]}},F=function(t){if(t.nested&&"a"===t.delta._t){var e=void 0,n=void 0,r=t.delta,i=t.left,o=[],a=[],f=[];for(e in r)if("_t"!==e)if("_"===e[0]){if(0!==r[e][2]&&3!==r[e][2])throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+r[e][2]);o.push(parseInt(e.slice(1),10))}else 1===r[e].length?a.push({index:parseInt(e,10),value:r[e][0]}):f.push({index:parseInt(e,10),delta:r[e]});for(e=(o=o.sort(I)).length-1;e>=0;e--){var s=r["_"+(n=o[e])],l=i.splice(n,1)[0];3===s[2]&&a.push({index:s[1],value:l})}var u=(a=a.sort(V("index"))).length;for(e=0;e<u;e++){var c=a[e];i.splice(c.index,0,c.value)}var d=f.length,h=void 0;if(d>0)for(e=0;e<d;e++){var p=f[e];h=new m(t.left[p.index],p.delta),t.push(h,p.index)}t.children?t.exit():t.setResult(t.left).exit()}};F.filterName="arrays";var q=function(t){if(t&&t.children&&"a"===t.delta._t){for(var e=t.children.length,n=void 0,r=0;r<e;r++)t.left[(n=t.children[r]).childName]=n.result;t.setResult(t.left).exit()}};q.filterName="arraysCollectChildren";var L=function(t){if(t.nested){if("a"===t.delta._t){var e=void 0,n=void 0;for(e in t.delta)"_t"!==e&&(n=new g(t.delta[e]),t.push(n,e));t.exit()}}else 3===t.delta[2]&&(t.newName="_"+t.delta[1],t.setResult([t.delta[0],parseInt(t.childName.substr(1),10),3]).exit())};L.filterName="arrays";var M=function(t,e,n){if("string"==typeof e&&"_"===e[0])return parseInt(e.substr(1),10);if(E(n)&&0===n[2])return"_"+e;var r=+e;for(var i in t){var o=t[i];if(E(o))if(3===o[2]){var a=parseInt(i.substr(1),10),f=o[1];if(f===+e)return a;a<=r&&f>r?r++:a>=r&&f<r&&r--}else if(0===o[2]){parseInt(i.substr(1),10)<=r&&r++}else 1===o.length&&i<=r&&r--}return r};function B(t){if(t&&t.children&&"a"===t.delta._t){for(var e=t.children.length,n=void 0,r={_t:"a"},i=0;i<e;i++){var o=(n=t.children[i]).newName;void 0===o&&(o=M(t.delta,n.childName,n.result)),r[o]!==n.result&&(r[o]=n.result)}t.setResult(r).exit()}}B.filterName="arraysCollectChildren";var H=function(t){t.left instanceof Date?(t.right instanceof Date?t.left.getTime()!==t.right.getTime()?t.setResult([t.left,t.right]):t.setResult(void 0):t.setResult([t.left,t.right]),t.exit()):t.right instanceof Date&&t.setResult([t.left,t.right]).exit()};H.filterName="dates";var z=null,U=function(t){if(!z){var n=void 0;if("undefined"!=typeof diff_match_patch)n="function"==typeof diff_match_patch?new diff_match_patch:new diff_match_patch.diff_match_patch;else if(e)try{n=e&&new e}catch(t){n=null}if(!n){if(!t)return null;var r=new Error("text diff_match_patch library not found");throw r.diff_match_patch_not_found=!0,r}z={diff:function(t,e){return n.patch_toText(n.patch_make(t,e))},patch:function(t,e){for(var r=n.patch_apply(n.patch_fromText(e),t),i=0;i<r[1].length;i++){if(!r[1][i])new Error("text patch failed").textPatchFailed=!0}return r[0]}}}return z},$=function(t){if("string"===t.leftType){var e=t.options&&t.options.textDiff&&t.options.textDiff.minLength||60;if(t.left.length<e||t.right.length<e)t.setResult([t.left,t.right]).exit();else{var n=U();if(n)t.setResult([(0,n.diff)(t.left,t.right),0,2]).exit();else t.setResult([t.left,t.right]).exit()}}};$.filterName="texts";var J=function(t){if(!t.nested&&2===t.delta[2]){var e=U(!0).patch;t.setResult(e(t.left,t.delta[0])).exit()}};J.filterName="texts";var Q=function(t){t.nested||2===t.delta[2]&&t.setResult([function(t){var e,n=void 0,r=void 0,i=void 0,o=void 0,a=null,f=/^@@ +-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(n=0,e=(r=t.split("\n")).length;n<e;n++){var s=(i=r[n]).slice(0,1);"@"===s?(a=f.exec(i),r[n]="@@ -"+a[3]+","+a[4]+" +"+a[1]+","+a[2]+" @@"):"+"===s?(r[n]="-"+r[n].slice(1),"+"===r[n-1].slice(0,1)&&(o=r[n],r[n]=r[n-1],r[n-1]=o)):"-"===s&&(r[n]="+"+r[n].slice(1))}return r.join("\n")}(t.delta[0]),0,2]).exit()};Q.filterName="texts";var K=function(){function t(e){i(this,t),this.processor=new c(e),this.processor.pipe(new d("diff").append(w,_,H,$,j,S).shouldHaveResult()),this.processor.pipe(new d("patch").append(R,q,b,J,O,F).shouldHaveResult()),this.processor.pipe(new d("reverse").append(A,B,k,Q,C,L).shouldHaveResult())}return o(t,[{key:"options",value:function(){var t;return(t=this.processor).options.apply(t,arguments)}},{key:"diff",value:function(t,e){return this.processor.process(new y(t,e))}},{key:"patch",value:function(t,e){return this.processor.process(new m(t,e))}},{key:"reverse",value:function(t){return this.processor.process(new g(t))}},{key:"unpatch",value:function(t,e){return this.patch(t,this.reverse(e))}},{key:"clone",value:function(t){return v(t)}}]),t}(),W="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},Z="function"==typeof Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},G=function(t){return"_t"===t?-1:"_"===t.substr(0,1)?parseInt(t.slice(1),10):parseInt(t,10)+.1},X=function(t,e){return G(t)-G(e)},Y=function(){function t(){i(this,t)}return o(t,[{key:"format",value:function(t,e){var n={};return this.prepareContext(n),this.recurse(n,t,e),this.finalize(n)}},{key:"prepareContext",value:function(t){t.buffer=[],t.out=function(){var t;(t=this.buffer).push.apply(t,arguments)}}},{key:"typeFormattterNotFound",value:function(t,e){throw new Error("cannot format delta type: "+e)}},{key:"typeFormattterErrorFormatter",value:function(t,e){return e.toString()}},{key:"finalize",value:function(t){var e=t.buffer;if(W(e))return e.join("")}},{key:"recurse",value:function(t,e,n,r,i,o,a){var f=e&&o?o.value:n;if(void 0!==e||void 0!==r){var s=this.getDeltaType(e,o),l="node"===s?"a"===e._t?"array":"object":"";void 0!==r?this.nodeBegin(t,r,i,s,l,a):this.rootBegin(t,s,l);try{(this["format_"+s]||this.typeFormattterNotFound(t,s)).call(this,t,e,f,r,i,o)}catch(n){this.typeFormattterErrorFormatter(t,n,e,f,r,i,o),"undefined"!=typeof console&&console.error&&console.error(n.stack)}void 0!==r?this.nodeEnd(t,r,i,s,l,a):this.rootEnd(t,s,l)}}},{key:"formatDeltaChildren",value:function(t,e,n){var r=this;this.forEachDeltaKey(e,n,function(i,o,a,f){r.recurse(t,e[i],n?n[o]:void 0,i,o,a,f)})}},{key:"forEachDeltaKey",value:function(t,e,n){var r,i=Z(t),o="a"===t._t,a={},f=void 0;if(void 0!==e)for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&(void 0!==t[f]||o&&void 0!==t["_"+f]||i.push(f));for(f in t)if(Object.prototype.hasOwnProperty.call(t,f)){var s=t[f];W(s)&&3===s[2]&&(a[s[1].toString()]={key:f,value:e&&e[parseInt(f.substr(1))]},!1!==this.includeMoveDestinations&&void 0===e&&void 0===t[s[1]]&&i.push(s[1].toString()))}o?i.sort(X):i.sort();for(var l=0,u=i.length;l<u;l++){var c=i[l];if(!o||"_t"!==c){var d=o?"number"==typeof c?c:parseInt("_"===(r=c).substr(0,1)?r.slice(1):r,10):c;n(c,d,a[d],l===u-1)}}}},{key:"getDeltaType",value:function(t,e){if(void 0===t)return void 0!==e?"movedestination":"unchanged";if(W(t)){if(1===t.length)return"added";if(2===t.length)return"modified";if(3===t.length&&0===t[2])return"deleted";if(3===t.length&&2===t[2])return"textdiff";if(3===t.length&&3===t[2])return"moved"}else if("object"===(void 0===t?"undefined":r(t)))return"node";return"unknown"}},{key:"parseTextDiff",value:function(t){for(var e=[],n=t.split("\n@@ "),r=0,i=n.length;r<i;r++){var o=n[r],a={pieces:[]},f=/^(?:@@ )?[-+]?(\d+),(\d+)/.exec(o).slice(1);a.location={line:f[0],chr:f[1]};for(var s=o.split("\n").slice(1),l=0,u=s.length;l<u;l++){var c=s[l];if(c.length){var d={type:"context"};"+"===c.substr(0,1)?d.type="added":"-"===c.substr(0,1)&&(d.type="deleted"),d.text=c.slice(1),a.pieces.push(d)}}e.push(a)}return e}}]),t}(),tt=Object.freeze({default:Y}),et=function(){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,Y),o(t,[{key:"typeFormattterErrorFormatter",value:function(t,e){t.out('<pre class="jsondiffpatch-error">'+e+"</pre>")}},{key:"formatValue",value:function(t,e){t.out("<pre>"+nt(JSON.stringify(e,null,2))+"</pre>")}},{key:"formatTextDiffString",value:function(t,e){var n=this.parseTextDiff(e);t.out('<ul class="jsondiffpatch-textdiff">');for(var r=0,i=n.length;r<i;r++){var o=n[r];t.out('<li><div class="jsondiffpatch-textdiff-location"><span class="jsondiffpatch-textdiff-line-number">'+o.location.line+'</span><span class="jsondiffpatch-textdiff-char">'+o.location.chr+'</span></div><div class="jsondiffpatch-textdiff-line">');for(var a=o.pieces,f=0,s=a.length;f<s;f++){var l=a[f];t.out('<span class="jsondiffpatch-textdiff-'+l.type+'">'+nt(decodeURI(l.text))+"</span>")}t.out("</div></li>")}t.out("</ul>")}},{key:"rootBegin",value:function(t,e,n){t.out('<div class="jsondiffpatch-delta '+("jsondiffpatch-"+e+(n?" jsondiffpatch-child-node-type-"+n:""))+'">')}},{key:"rootEnd",value:function(t){t.out("</div>"+(t.hasArrows?'<script type="text/javascript">setTimeout('+rt.toString()+",10);<\/script>":""))}},{key:"nodeBegin",value:function(t,e,n,r,i){t.out('<li class="'+("jsondiffpatch-"+r+(i?" jsondiffpatch-child-node-type-"+i:""))+'" data-key="'+n+'"><div class="jsondiffpatch-property-name">'+n+"</div>")}},{key:"nodeEnd",value:function(t){t.out("</li>")}},{key:"format_unchanged",value:function(t,e,n){void 0!==n&&(t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,n),t.out("</div>"))}},{key:"format_movedestination",value:function(t,e,n){void 0!==n&&(t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,n),t.out("</div>"))}},{key:"format_node",value:function(t,e,n){t.out('<ul class="jsondiffpatch-node jsondiffpatch-node-type-'+("a"===e._t?"array":"object")+'">'),this.formatDeltaChildren(t,e,n),t.out("</ul>")}},{key:"format_added",value:function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out("</div>")}},{key:"format_modified",value:function(t,e){t.out('<div class="jsondiffpatch-value jsondiffpatch-left-value">'),this.formatValue(t,e[0]),t.out('</div><div class="jsondiffpatch-value jsondiffpatch-right-value">'),this.formatValue(t,e[1]),t.out("</div>")}},{key:"format_deleted",value:function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out("</div>")}},{key:"format_moved",value:function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatValue(t,e[0]),t.out('</div><div class="jsondiffpatch-moved-destination">'+e[1]+"</div>"),t.out('<div class="jsondiffpatch-arrow" style="position: relative; left: -34px;">\n          <svg width="30" height="60" style="position: absolute; display: none;">\n          <defs>\n              <marker id="markerArrow" markerWidth="8" markerHeight="8"\n                 refx="2" refy="4"\n                     orient="auto" markerUnits="userSpaceOnUse">\n                  <path d="M1,1 L1,7 L7,4 L1,1" style="fill: #339;" />\n              </marker>\n          </defs>\n          <path d="M30,0 Q-10,25 26,50"\n            style="stroke: #88f; stroke-width: 2px; fill: none; stroke-opacity: 0.5; marker-end: url(#markerArrow);"\n          ></path>\n          </svg>\n      </div>'),t.hasArrows=!0}},{key:"format_textdiff",value:function(t,e){t.out('<div class="jsondiffpatch-value">'),this.formatTextDiffString(t,e[0]),t.out("</div>")}}]),t}();function nt(t){for(var e=t,n=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"],[/'/g,"&apos;"],[/"/g,"&quot;"]],r=0;r<n.length;r++)e=e.replace(n[r][0],n[r][1]);return e}var rt=function(t){!function(t,e,n){for(var r=t.querySelectorAll(e),i=0,o=r.length;i<o;i++)n(r[i])}(t||document,".jsondiffpatch-arrow",function(t){var e=t.style,n=t.parentNode,r=t.children[0],i=r.children[1];r.style.display="none";var o,a=(o=n.querySelector(".jsondiffpatch-moved-destination")).textContent||o.innerText,f=void 0;if(function(t,e){for(var n=t.children,r=0,i=n.length;r<i;r++)e(n[r],r)}(n.parentNode,function(t){t.getAttribute("data-key")===a&&(f=t)}),f)try{var s=f.offsetTop-n.offsetTop;r.setAttribute("height",Math.abs(s)+6),e.top=-8+(s>0?0:s)+"px";var l=s>0?"M30,0 Q-10,"+Math.round(s/2)+" 26,"+(s-4):"M30,"+-s+" Q-10,"+Math.round(-s/2)+" 26,4";i.setAttribute("d",l),r.style.display=""}catch(t){}})},it=function(t,e,n){var r=e||document.body,i="jsondiffpatch-unchanged-",o={showing:i+"showing",hiding:i+"hiding",visible:i+"visible",hidden:i+"hidden"},a=r.classList;if(a){if(!n)return a.remove(o.showing),a.remove(o.hiding),a.remove(o.visible),a.remove(o.hidden),void(!1===t&&a.add(o.hidden));!1===t?(a.remove(o.showing),a.add(o.visible),setTimeout(function(){a.add(o.hiding)},10)):(a.remove(o.hiding),a.add(o.showing),a.remove(o.hidden));var f=setInterval(function(){rt(r)},100);setTimeout(function(){a.remove(o.showing),a.remove(o.hiding),!1===t?(a.add(o.hidden),a.remove(o.visible)):(a.add(o.visible),a.remove(o.hidden)),setTimeout(function(){a.remove(o.visible),clearInterval(f)},n+400)},n)}},ot=void 0;var at=Object.freeze({showUnchanged:it,hideUnchanged:function(t,e){return it(!1,t,e)},default:et,format:function(t,e){return ot||(ot=new et),ot.format(t,e)}}),ft=function(){function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.includeMoveDestinations=!1,e}return f(t,Y),o(t,[{key:"prepareContext",value:function(e){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"prepareContext",this).call(this,e),e.indent=function(t){this.indentLevel=(this.indentLevel||0)+(void 0===t?1:t),this.indentPad=new Array(this.indentLevel+1).join("&nbsp;&nbsp;")},e.row=function(t,n){e.out('<tr><td style="white-space: nowrap;"><pre class="jsondiffpatch-annotated-indent" style="display: inline-block">'),e.out(e.indentPad),e.out('</pre><pre style="display: inline-block">'),e.out(t),e.out('</pre></td><td class="jsondiffpatch-delta-note"><div>'),e.out(n),e.out("</div></td></tr>")}}},{key:"typeFormattterErrorFormatter",value:function(t,e){t.row("",'<pre class="jsondiffpatch-error">'+e+"</pre>")}},{key:"formatTextDiffString",value:function(t,e){var n=this.parseTextDiff(e);t.out('<ul class="jsondiffpatch-textdiff">');for(var r=0,i=n.length;r<i;r++){var o=n[r];t.out('<li><div class="jsondiffpatch-textdiff-location"><span class="jsondiffpatch-textdiff-line-number">'+o.location.line+'</span><span class="jsondiffpatch-textdiff-char">'+o.location.chr+'</span></div><div class="jsondiffpatch-textdiff-line">');for(var a=o.pieces,f=0,s=a.length;f<s;f++){var l=a[f];t.out('<span class="jsondiffpatch-textdiff-'+l.type+'">'+l.text+"</span>")}t.out("</div></li>")}t.out("</ul>")}},{key:"rootBegin",value:function(t,e,n){t.out('<table class="jsondiffpatch-annotated-delta">'),"node"===e&&(t.row("{"),t.indent()),"array"===n&&t.row('"_t": "a",',"Array delta (member names indicate array indices)")}},{key:"rootEnd",value:function(t,e){"node"===e&&(t.indent(-1),t.row("}")),t.out("</table>")}},{key:"nodeBegin",value:function(t,e,n,r,i){t.row("&quot;"+e+"&quot;: {"),"node"===r&&t.indent(),"array"===i&&t.row('"_t": "a",',"Array delta (member names indicate array indices)")}},{key:"nodeEnd",value:function(t,e,n,r,i,o){"node"===r&&t.indent(-1),t.row("}"+(o?"":","))}},{key:"format_unchanged",value:function(){}},{key:"format_movedestination",value:function(){}},{key:"format_node",value:function(t,e,n){this.formatDeltaChildren(t,e,n)}}]),t}(),st=function(t){return'<pre style="display:inline-block">&quot;'+t+"&quot;</pre>"},lt={added:function(t,e,n,r){var i=" <pre>([newValue])</pre>";return void 0===r?"new value"+i:"number"==typeof r?"insert at index "+r+i:"add property "+st(r)+i},modified:function(t,e,n,r){var i=" <pre>([previousValue, newValue])</pre>";return void 0===r?"modify value"+i:"number"==typeof r?"modify at index "+r+i:"modify property "+st(r)+i},deleted:function(t,e,n,r){var i=" <pre>([previousValue, 0, 0])</pre>";return void 0===r?"delete value"+i:"number"==typeof r?"remove index "+r+i:"delete property "+st(r)+i},moved:function(t,e,n,r){return'move from <span title="(position to remove at original state)">index '+r+'</span> to <span title="(position to insert at final state)">index '+t[1]+"</span>"},textdiff:function(t,e,n,r){return"text diff"+(void 0===r?"":"number"==typeof r?" at index "+r:" at property "+st(r))+', format is <a href="https://code.google.com/p/google-diff-match-patch/wiki/Unidiff">a variation of Unidiff</a>'}},ut=function(t,e){var n=this.getDeltaType(e),r=lt[n],i=r&&r.apply(r,Array.prototype.slice.call(arguments,1)),o=JSON.stringify(e,null,2);"textdiff"===n&&(o=o.split("\\n").join('\\n"+\n   "')),t.indent(),t.row(o,i),t.indent(-1)};ft.prototype.format_added=ut,ft.prototype.format_modified=ut,ft.prototype.format_deleted=ut,ft.prototype.format_moved=ut,ft.prototype.format_textdiff=ut;var ct=void 0;var dt=Object.freeze({default:ft,format:function(t,e){return ct||(ct=new ft),ct.format(t,e)}}),ht="add",pt="remove",vt="replace",yt="move",mt=function(){function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.includeMoveDestinations=!0,e}return f(t,Y),o(t,[{key:"prepareContext",value:function(e){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"prepareContext",this).call(this,e),e.result=[],e.path=[],e.pushCurrentOp=function(t){var e=t.value,n={op:t.op,path:this.currentPath()};void 0!==e&&(n.value=e),this.result.push(n)},e.pushMoveOp=function(t){var e=this.currentPath();this.result.push({op:yt,from:e,path:this.toPath(t)})},e.currentPath=function(){return"/"+this.path.join("/")},e.toPath=function(t){var e=this.path.slice();return e[e.length-1]=t,"/"+e.join("/")}}},{key:"typeFormattterErrorFormatter",value:function(t,e){t.out("[ERROR] "+e)}},{key:"rootBegin",value:function(){}},{key:"rootEnd",value:function(){}},{key:"nodeBegin",value:function(t,e,n){t.path.push(n)}},{key:"nodeEnd",value:function(t){t.path.pop()}},{key:"format_unchanged",value:function(){}},{key:"format_movedestination",value:function(){}},{key:"format_node",value:function(t,e,n){this.formatDeltaChildren(t,e,n)}},{key:"format_added",value:function(t,e){t.pushCurrentOp({op:ht,value:e[0]})}},{key:"format_modified",value:function(t,e){t.pushCurrentOp({op:vt,value:e[1]})}},{key:"format_deleted",value:function(t){t.pushCurrentOp({op:pt})}},{key:"format_moved",value:function(t,e){t.pushMoveOp(e[1])}},{key:"format_textdiff",value:function(){throw new Error("Not implemented")}},{key:"format",value:function(t,e){var n={};return this.prepareContext(n),this.recurse(n,t,e),n.result}}]),t}(),gt=function(t){return t[t.length-1]},xt=function(t){return(e=t).sort(function(t,e){var n,r,i,o,a=t.path.split("/"),f=e.path.split("/");return a.length!==f.length?a.length-f.length:(n=gt(a),r=gt(f),i=parseInt(n,10),o=parseInt(r,10),isNaN(i)||isNaN(o)?0:o-i)}),e;var e},_t=function(t,e){var n=Array(e.length+1).fill().map(function(){return[]});return t.map(function(t){var n=e.map(function(e){return e(t)}).indexOf(!0);return n<0&&(n=e.length),{item:t,position:n}}).reduce(function(t,e){return t[e.position].push(e.item),t},n)},bt=function(t){return"move"===t.op},kt=function(t){return"remove"===t.op},wt=void 0,jt=function(t,e){return wt||(wt=new mt),n=wt.format(t,e),r=_t(n,[bt,kt]),i=l(r,3),o=i[0],a=i[2],f=xt(i[1]),[].concat(u(f),u(o),u(a));var n,r,i,o,a,f},Ot=Object.freeze({default:mt,partitionOps:_t,format:jt,log:function(t,e){console.log(jt(t,e))}});function Rt(t){return n&&n[t]||function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e}}var Ct={added:Rt("green"),deleted:Rt("red"),movedestination:Rt("gray"),moved:Rt("yellow"),unchanged:Rt("gray"),error:Rt("white.bgRed"),textDiffLine:Rt("gray")},At=function(){function t(){i(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.includeMoveDestinations=!1,e}return f(t,Y),o(t,[{key:"prepareContext",value:function(e){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"prepareContext",this).call(this,e),e.indent=function(t){this.indentLevel=(this.indentLevel||0)+(void 0===t?1:t),this.indentPad=new Array(this.indentLevel+1).join("  "),this.outLine()},e.outLine=function(){this.buffer.push("\n"+(this.indentPad||""))},e.out=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e.length;r<i;r++){var o=e[r].split("\n").join("\n"+(this.indentPad||""));this.color&&this.color[0]&&(o=this.color[0](o)),this.buffer.push(o)}},e.pushColor=function(t){this.color=this.color||[],this.color.unshift(t)},e.popColor=function(){this.color=this.color||[],this.color.shift()}}},{key:"typeFormattterErrorFormatter",value:function(t,e){t.pushColor(Ct.error),t.out("[ERROR]"+e),t.popColor()}},{key:"formatValue",value:function(t,e){t.out(JSON.stringify(e,null,2))}},{key:"formatTextDiffString",value:function(t,e){var n=this.parseTextDiff(e);t.indent();for(var r=0,i=n.length;r<i;r++){var o=n[r];t.pushColor(Ct.textDiffLine),t.out(o.location.line+","+o.location.chr+" "),t.popColor();for(var a=o.pieces,f=0,s=a.length;f<s;f++){var l=a[f];t.pushColor(Ct[l.type]),t.out(l.text),t.popColor()}r<i-1&&t.outLine()}t.indent(-1)}},{key:"rootBegin",value:function(t,e,n){t.pushColor(Ct[e]),"node"===e&&(t.out("array"===n?"[":"{"),t.indent())}},{key:"rootEnd",value:function(t,e,n){"node"===e&&(t.indent(-1),t.out("array"===n?"]":"}")),t.popColor()}},{key:"nodeBegin",value:function(t,e,n,r,i){t.pushColor(Ct[r]),t.out(n+": "),"node"===r&&(t.out("array"===i?"[":"{"),t.indent())}},{key:"nodeEnd",value:function(t,e,n,r,i,o){"node"===r&&(t.indent(-1),t.out("array"===i?"]":"}"+(o?"":","))),o||t.outLine(),t.popColor()}},{key:"format_unchanged",value:function(t,e,n){void 0!==n&&this.formatValue(t,n)}},{key:"format_movedestination",value:function(t,e,n){void 0!==n&&this.formatValue(t,n)}},{key:"format_node",value:function(t,e,n){this.formatDeltaChildren(t,e,n)}},{key:"format_added",value:function(t,e){this.formatValue(t,e[0])}},{key:"format_modified",value:function(t,e){t.pushColor(Ct.deleted),this.formatValue(t,e[0]),t.popColor(),t.out(" => "),t.pushColor(Ct.added),this.formatValue(t,e[1]),t.popColor()}},{key:"format_deleted",value:function(t,e){this.formatValue(t,e[0])}},{key:"format_moved",value:function(t,e){t.out("==> "+e[1])}},{key:"format_textdiff",value:function(t,e){this.formatTextDiffString(t,e[0])}}]),t}(),Nt=void 0,Pt=function(t,e){return Nt||(Nt=new At),Nt.format(t,e)};var Et=Object.freeze({default:At,format:Pt,log:function(t,e){console.log(Pt(t,e))}}),Tt=Object.freeze({base:tt,html:at,annotated:dt,jsonpatch:Ot,console:Et});var Dt=void 0;t.DiffPatcher=K,t.formatters=Tt,t.console=Et,t.create=function(t){return new K(t)},t.dateReviver=function(t,e){var n=void 0;return"string"==typeof e&&(n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+-])(\d{2}):(\d{2}))$/.exec(e))?new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6],+(n[7]||0))):e},t.diff=function(){return Dt||(Dt=new K),Dt.diff.apply(Dt,arguments)},t.patch=function(){return Dt||(Dt=new K),Dt.patch.apply(Dt,arguments)},t.unpatch=function(){return Dt||(Dt=new K),Dt.unpatch.apply(Dt,arguments)},t.reverse=function(){return Dt||(Dt=new K),Dt.reverse.apply(Dt,arguments)},t.clone=function(){return Dt||(Dt=new K),Dt.clone.apply(Dt,arguments)},Object.defineProperty(t,"__esModule",{value:!0})});